DEVICE = cpu # {cpu, nvidia}
DEBUG = no # {yes, no}

CPU = CPU_DEVICE
NVIDIA = NVIDIA_DEVICE

PDEVICE = $(CPU)

ifeq ($(DEVICE),nvidia)
  PDEVICE = $(NVIDIA)
endif

CC = syclcc
CFLAGS = -O3 -D$(PDEVICE)

ifeq ($(PDEVICE),$(NVIDIA_DEVICE))
  CFLAGS += --hipsycl-targets="cuda-nvcxx:cc86"
else
  CFLAGS += --hipsycl-targets="omp" --hipsycl-use-accelerated-cpu -w
endif

ifeq ($(DEBUG),yes)
	CFLAGS += -g
endif

k_means: ./device/device.o main.o
	$(CC) $(CFLAGS) main.o ./device/device.o -o k_means

main.o: ./device/device.o
	$(CC) $(CFLAGS) main.cpp -c -o main.o

./device/device.o: ./device/device.hpp
	$(CC) $(CFLAGS) ./device/device.cpp -c -o ./device/device.o

run: k_means
	./k_means ../../data/USCensus1990.data.txt

.PHONY: clean
clean:
	rm -f k_means \
	*.o \
	./device/*.o